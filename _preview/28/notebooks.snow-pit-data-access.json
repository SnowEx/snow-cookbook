{"version":2,"kind":"Notebook","sha256":"add1995891316db793ee44a295d81129f84dc6ca2ada7952670e6002f030d53d","slug":"notebooks.snow-pit-data-access","location":"/notebooks/snow-pit_data_access.ipynb","dependencies":[],"frontmatter":{"title":"Snow Pit Data Access and SWE Calculation","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"The SnowPit Community","given":"The SnowPit","family":"Community"},"name":"The SnowPit Community","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/SnowEx/snow-cookbook","copyright":"2025","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/SnowEx/snow-cookbook/blob/HEAD/notebooks/snow-pit_data_access.ipynb","edit_url":"https://github.com/SnowEx/snow-cookbook/edit/HEAD/notebooks/snow-pit_data_access.ipynb","exports":[{"format":"ipynb","filename":"snow-pit_data_access.ipynb","url":"/snow-cookbook/_preview/28/build/snow-pit_data_access-24f55ac16b5899bd9db747ba0b8fa2aa.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook is designed to access data from snow pits gathered during the SnowEx field campaigns. There are two embedded examples: a simple use case with ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i7RoUmClPE"},{"type":"inlineCode","value":"earthaccess","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LD5ydCKJGB"},{"type":"text","value":" and snow depth data, and a more advanced example using the SnowEx database (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U0AT5K5IVK"},{"type":"inlineCode","value":"snowexsql","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"c2yfl5Sgoc"},{"type":"text","value":") to obtain snow depth and density.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yL8tSnDEw4"}],"key":"MHuLCFUzDA"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kOPSyZMDrI"},{"type":"inlineCode","value":"snowexsql","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"B3mppNesSm"},{"type":"text","value":" example uses code from a SnowEx Database example found here: ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Mkdo4DWR2d"},{"type":"link","url":"https://snowexsql.readthedocs.io/en/latest/gallery/plot_pit_swe_example.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"https://​snowexsql​.readthedocs​.io​/en​/latest​/gallery​/plot​_pit​_swe​_example​.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"J1Gqx7miv7"}],"urlSource":"https://snowexsql.readthedocs.io/en/latest/gallery/plot_pit_swe_example.html","key":"LjkIIpLlqi"},{"type":"text","value":". Additional thanks goes to Anthony Arendt and Joachim Meyer for their insights on proper syntax with the code.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DlDhdLgWQx"}],"key":"VgsGuVxRaF"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"This notebook uses the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"rhDIzev281"},{"type":"inlineCode","value":"contextily","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hjgNJHfOPL"},{"type":"text","value":" and ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uQlK1Hd2lT"},{"type":"inlineCode","value":"cmcrameri","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dyD6pIVlFx"},{"type":"text","value":" packages for map plotting and colorblind-friendly coloring, respectively. Use the below cell to install both, and to ensure that ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"K2ggZsWCIf"},{"type":"inlineCode","value":"snowexsql","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SOTnieNKxP"},{"type":"text","value":" is up-to-date.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DoL4kEd1xH"}],"key":"nZhCzzcF2I"}],"key":"mMWDdmWL7q"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"!pip install contextily cmcrameri\n!pip install snowexsql -U","key":"gqHbRkebGd"},{"type":"output","id":"WfmrKlsDFQus00OBgT37M","data":[{"output_type":"stream","name":"stdout","text":"Collecting contextily\r\n"},{"output_type":"stream","name":"stdout","text":"  Downloading contextily-1.6.2-py3-none-any.whl.metadata (2.9 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"Collecting cmcrameri\r\n  Downloading cmcrameri-1.9-py3-none-any.whl.metadata (4.6 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"Collecting geopy (from contextily)\r\n  Downloading geopy-2.4.1-py3-none-any.whl.metadata (6.8 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"Collecting matplotlib (from contextily)\r\n  Downloading matplotlib-3.10.7-cp314-cp314-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl.metadata (11 kB)\r\nCollecting mercantile (from contextily)\r\n"},{"output_type":"stream","name":"stdout","text":"  Downloading mercantile-1.2.1-py3-none-any.whl.metadata (4.8 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"Collecting pillow (from contextily)\r\n  Downloading pillow-12.0.0-cp314-cp314-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl.metadata (8.8 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"Collecting rasterio (from contextily)\r\n"},{"output_type":"stream","name":"stdout","text":"  Downloading rasterio-1.4.3.tar.gz (442 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"  Installing build dependencies ... \u001b[?25l-"},{"output_type":"stream","name":"stdout","text":"\b \b\\"},{"output_type":"stream","name":"stdout","text":"\b \b|"},{"output_type":"stream","name":"stdout","text":"\b \b/"},{"output_type":"stream","name":"stdout","text":"\b \b-"},{"output_type":"stream","name":"stdout","text":"\b \b\\"},{"output_type":"stream","name":"stdout","text":"\b \b|"},{"output_type":"stream","name":"stdout","text":"\b \b/"},{"output_type":"stream","name":"stdout","text":"\b \b-"},{"output_type":"stream","name":"stdout","text":"\b \b\\"},{"output_type":"stream","name":"stdout","text":"\b \bdone\r\n"},{"output_type":"stream","name":"stdout","text":"\u001b[?25h  Getting requirements to build wheel ... \u001b[?25l-"},{"output_type":"stream","name":"stdout","text":"\b \berror\r\n  \u001b[1;31merror\u001b[0m: \u001b[1msubprocess-exited-with-error\u001b[0m\r\n  \r\n  \u001b[31m×\u001b[0m \u001b[32mGetting requirements to build wheel\u001b[0m did not run successfully.\r\n  \u001b[31m│\u001b[0m exit code: \u001b[1;36m1\u001b[0m\r\n  \u001b[31m╰─>\u001b[0m \u001b[31m[2 lines of output]\u001b[0m\r\n  \u001b[31m   \u001b[0m WARNING:root:Failed to get options via gdal-config: [Errno 2] No such file or directory: 'gdal-config'\r\n  \u001b[31m   \u001b[0m ERROR: A GDAL API version must be specified. Provide a path to gdal-config using a GDAL_CONFIG environment variable or use a GDAL_VERSION environment variable.\r\n  \u001b[31m   \u001b[0m \u001b[31m[end of output]\u001b[0m\r\n  \r\n  \u001b[1;35mnote\u001b[0m: This error originates from a subprocess, and is likely not a problem with pip.\r\n\u001b[1;31merror\u001b[0m: \u001b[1msubprocess-exited-with-error\u001b[0m\r\n\r\n\u001b[31m×\u001b[0m \u001b[32mGetting requirements to build wheel\u001b[0m did not run successfully.\r\n\u001b[31m│\u001b[0m exit code: \u001b[1;36m1\u001b[0m\r\n\u001b[31m╰─>\u001b[0m See above for output.\r\n\r\n\u001b[1;35mnote\u001b[0m: This error originates from a subprocess, and is likely not a problem with pip.\r\n"},{"output_type":"stream","name":"stdout","text":"\u001b[?25h"},{"output_type":"stream","name":"stdout","text":"Collecting snowexsql\r\n"},{"output_type":"stream","name":"stdout","text":"  Downloading snowexsql-1.0.0-py3-none-any.whl.metadata (6.3 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"Collecting geoalchemy2<1.0,>=0.6 (from snowexsql)\r\n  Downloading geoalchemy2-0.18.0-py3-none-any.whl.metadata (2.3 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"Collecting geopandas<2.0,>=0.7 (from snowexsql)\r\n  Using cached geopandas-1.1.1-py3-none-any.whl.metadata (2.3 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"Collecting psycopg2-binary<2.10.0,>=2.9.0 (from snowexsql)\r\n  Downloading psycopg2_binary-2.9.11-cp314-cp314-manylinux2014_x86_64.manylinux_2_17_x86_64.whl.metadata (4.9 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"Collecting rasterio>=1.1.5 (from snowexsql)\r\n  Using cached rasterio-1.4.3.tar.gz (442 kB)\r\n"},{"output_type":"stream","name":"stdout","text":"  Installing build dependencies ... \u001b[?25l-"},{"output_type":"stream","name":"stdout","text":"\b \b\\"},{"output_type":"stream","name":"stdout","text":"\b \b|"},{"output_type":"stream","name":"stdout","text":"\b \b/"},{"output_type":"stream","name":"stdout","text":"\b \b-"},{"output_type":"stream","name":"stdout","text":"\b \b\\"},{"output_type":"stream","name":"stdout","text":"\b \b|"},{"output_type":"stream","name":"stdout","text":"\b \bdone\r\n"},{"output_type":"stream","name":"stdout","text":"\u001b[?25h  Getting requirements to build wheel ... \u001b[?25l-"},{"output_type":"stream","name":"stdout","text":"\b \berror\r\n  \u001b[1;31merror\u001b[0m: \u001b[1msubprocess-exited-with-error\u001b[0m\r\n  \r\n  \u001b[31m×\u001b[0m \u001b[32mGetting requirements to build wheel\u001b[0m did not run successfully.\r\n  \u001b[31m│\u001b[0m exit code: \u001b[1;36m1\u001b[0m\r\n  \u001b[31m╰─>\u001b[0m \u001b[31m[2 lines of output]\u001b[0m\r\n  \u001b[31m   \u001b[0m WARNING:root:Failed to get options via gdal-config: [Errno 2] No such file or directory: 'gdal-config'\r\n  \u001b[31m   \u001b[0m ERROR: A GDAL API version must be specified. Provide a path to gdal-config using a GDAL_CONFIG environment variable or use a GDAL_VERSION environment variable.\r\n  \u001b[31m   \u001b[0m \u001b[31m[end of output]\u001b[0m\r\n  \r\n  \u001b[1;35mnote\u001b[0m: This error originates from a subprocess, and is likely not a problem with pip.\r\n\u001b[1;31merror\u001b[0m: \u001b[1msubprocess-exited-with-error\u001b[0m\r\n\r\n\u001b[31m×\u001b[0m \u001b[32mGetting requirements to build wheel\u001b[0m did not run successfully.\r\n\u001b[31m│\u001b[0m exit code: \u001b[1;36m1\u001b[0m\r\n\u001b[31m╰─>\u001b[0m See above for output.\r\n\r\n\u001b[1;35mnote\u001b[0m: This error originates from a subprocess, and is likely not a problem with pip.\r\n"},{"output_type":"stream","name":"stdout","text":"\u001b[?25h"}],"key":"oiQ9hIasWD"}],"key":"n31ztjWywB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import earthaccess\nimport pandas as pd\nimport geopandas as gpd\nimport os\nimport tempfile\nfrom shapely.geometry import Point\nimport shutil\nimport cmcrameri.cm as cmc\nimport matplotlib.pyplot as plt\nimport contextily as ctx","key":"aChPw8W9WK"},{"type":"output","id":"0-4goHXyVYkoKEt-htEvS","data":[{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/cookbook-dev/lib/python3.14/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n  from .autonotebook import tqdm as notebook_tqdm\n"},{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mModuleNotFoundError\u001b[39m                       Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[2]\u001b[39m\u001b[32m, line 2\u001b[39m\n\u001b[32m      1\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mearthaccess\u001b[39;00m\n\u001b[32m----> \u001b[39m\u001b[32m2\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mpandas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mpd\u001b[39;00m\n\u001b[32m      3\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mgeopandas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mgpd\u001b[39;00m\n\u001b[32m      4\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mos\u001b[39;00m\n\n\u001b[31mModuleNotFoundError\u001b[39m: No module named 'pandas'","ename":"ModuleNotFoundError","evalue":"No module named 'pandas'"}],"key":"etdnT4JPiH"}],"key":"a05fBPBncQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"earthaccess example","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VgpBhIfTM6"}],"identifier":"earthaccess-example","label":"earthaccess example","html_id":"earthaccess-example","implicit":true,"key":"wM49gYn24w"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"For the earthaccess example, we are using the DOI of the “SnowEx20 Community Snow Depth Probe Measurements, Version 1” obtained at Grand Mesa, CO. These files are stored in CSV format, and contain snow depths using magnaprobes, Mesa2 tablets, and pit rulers.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"zEKmEDgWlz"}],"key":"qZ4rsMmNiQ"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Note that the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"EqFNgmsOtH"},{"type":"inlineCode","value":"short_name","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"iQmeCx2fLg"},{"type":"text","value":" of the dataset is provided in the cell. This may be used as an alternative to the DOI, if desired.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"kR7GU1saOW"}],"key":"XcoIwWPaPh"}],"key":"aGJKOujSzd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Authenticate with Earthdata Login servers\nauth = earthaccess.login(strategy=\"interactive\")\n\n# Search for granules\nresults = earthaccess.search_data(\n    #short_name=\"SNEX20_SD\",\n    doi = \"10.5067/9IA978JIACAR\",\n    temporal=('2020-01-01', '2020-03-01'),\n)","key":"oJtfyTUerh"},{"type":"output","id":"7tHNIsAqNZM3ZxofSS41l","data":[],"key":"dUKQ0IfdhX"}],"key":"rvyLXL6JNc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"display(results[0])","key":"kdf3PudLNV"},{"type":"output","id":"2cKZcMAmLAvDBKh09fYvq","data":[],"key":"l64FRSb4y8"}],"key":"XUrswf74oe"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Our query returned a single CSV file over the time frame of interest. Note how we did not include a spatial bound for the data here - this is because the dataset of interest only gathered data over Grand Mesa, CO.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YGNXcnWY55"}],"key":"HV0PZY3m2v"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To obtain the data, we will create a temporary directory (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rHmj9iVmvg"},{"type":"inlineCode","value":"tempfile.mkdtemp()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mZmVTgaBeU"},{"type":"text","value":"), and load the data into a GeoDataFrame. The temporary directory (and data within) will be deleted after processing.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"weywcnJ1Qa"}],"key":"JZmS0JYb4R"}],"key":"qL5hvXNiNS"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Create a temporary directory for downloads\ntemp_dir = tempfile.mkdtemp()\nprint(f\"Using temporary directory: {temp_dir}\")\n\n# Download the data to the temp directory\ndownloaded_files = earthaccess.download(\n    results,\n    local_path=temp_dir,\n)\nprint(f\"Downloaded {len(downloaded_files)} files to {temp_dir}\")\n\n# Process CSV files and convert to GeoDataFrame\ngdf = gpd.GeoDataFrame()\ncsv_files = [file for file in downloaded_files if file.endswith('.csv')]\nif csv_files:\n    for i, csv_file in enumerate(csv_files):\n        print(f\"Processing: {os.path.basename(csv_file)}\")\n\n        # Read the csv file\n        tmp_df = pd.read_csv(csv_file)\n\n        # Convert to GeoDataFrame\n        geometry = [Point(xy) for xy in zip(tmp_df['Easting'], tmp_df['Northing'])]\n        tmp_gdf = gpd.GeoDataFrame(tmp_df, geometry=geometry, crs=\"EPSG:32612\")\n\n        # Add to final GeoDataFrame\n        gdf = pd.concat([gdf, tmp_gdf])\n\nprint(\"All files processed.\")\nprint(' ')\nprint(f\"Removing temporary directory: {temp_dir}\")\nshutil.rmtree(temp_dir)","key":"WqRcbjvAdB"},{"type":"output","id":"cES9V2AY6pILZQNpfaYE3","data":[],"key":"LIt7uKWGQS"}],"key":"XHltAce6gN"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Fast and easy! We can now check out the contents of the data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yixyKSFINc"}],"key":"vNPLCXxnTD"}],"key":"dbsrFs5FeW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"gdf.head()","key":"Imgaw2MxxI"},{"type":"output","id":"TMnszGkOjhFEhNgfXuHaH","data":[],"key":"UvBRVcUaXy"}],"key":"UvRU8vxSRV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Some columns of interest include:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N0WFJEmYVO"}],"key":"OBXZYesEPY"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"Measurement Tool [...]","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cyS2fCvhLx"},{"type":"text","value":": The measurement tool used to measure snow depth: MP = magnaprobe, M2 = Mesa2 tablet, and PR = pit ruler.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RgM3LMsXe0"}],"key":"cXdIn85aE9"}],"key":"gUqgxjNOxI"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"Date [...]","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u68SotT7Ws"},{"type":"text","value":": The date of the measurement, in yyyymmdd format.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"X9s3FDndH5"}],"key":"fDVXuI71eX"}],"key":"r77IsCyOlT"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"PitID","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"tw4QcrF6wq"},{"type":"text","value":": The designated pit ID associated with the measurement.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vt9PndQmvr"}],"key":"tFwm9NACeG"}],"key":"EGXnOZ7u6X"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"Depth (cm)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DcoXGqvYXR"},{"type":"text","value":": Snow depth, in centimeters.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wk9xTS7AXG"}],"key":"v40LGbqzAE"}],"key":"qUbrmjjQFA"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"elevation (m)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xf0z7P0HBv"},{"type":"text","value":": Surface elevation at the location of the measurement.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Sooq20U8JA"}],"key":"aJFHeiPKWP"}],"key":"mISSd48PZl"}],"key":"yBSbquslOE"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"The key variables for this example - the measurement approach and the depth - could use renaming. Let’s do that now.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"cZekzdNUN7"}],"key":"PgGYZZANsi"}],"key":"ewDLkKSlQc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"gdf.rename(columns={\"Measurement Tool (MP = Magnaprobe; M2 = Mesa 2; PR = Pit Ruler)\": 'measurement_tool',\n                    \"Depth (cm)\": 'snow_depth'}, inplace=True\n          )","key":"s7TxqUknYZ"},{"type":"output","id":"PKlFpBPNI8M5tID9Lr1qk","data":[],"key":"b0UA2kcZ6v"}],"key":"ewPbbC30Kp"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, let’s make a map plot showing the locations of the measurements, colored by snow depth value.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wsOTdfDxWD"}],"key":"vGQn2JFYrG"}],"key":"KSoQX8avm9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(figsize=(10, 10))\n\n# Define min/max values for colormap\nvmin = gdf['snow_depth'].quantile(0.15)\nvmax = gdf['snow_depth'].quantile(0.85)\n\n# Convert to EPSG:3857 to match with the contextily basemap\nif gdf.crs != 'EPSG:3857':\n    gdf_web = gdf.to_crs(epsg=3857)\n    ax.set_xlim(gdf_web.total_bounds[[0, 2]])\n    ax.set_ylim(gdf_web.total_bounds[[1, 3]])\nelse:\n    ax.set_xlim(gdf.total_bounds[[0, 2]])\n    ax.set_ylim(gdf.total_bounds[[1, 3]])\n\n# Plot snow depths by location\ngdf_web.plot(\n    column='snow_depth',\n    ax=ax,\n    markersize=10,\n    cmap='cmc.navia',\n    legend=True,\n    legend_kwds={'shrink': 0.3, 'label': 'Snow depth [cm]'},\n    vmin=vmin,\n    vmax=vmax\n)\n\n# Add topographic map for spatial reference\nctx.add_basemap(\n    ax, \n    source=ctx.providers.OpenTopoMap,\n    zoom='auto'\n)\n\nax.set_xlabel(\"Easting [m]\", fontsize=14)\nax.set_ylabel(\"Northing [m]\", fontsize=14)\nplt.tight_layout()\nplt.show()","key":"hCsThNY44o"},{"type":"output","id":"wV_fuQV1pIVKxIFCVnN_g","data":[],"key":"ZGEE6TNfnu"}],"key":"Gl1qwA3w6j"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The above map looks pretty cool, but we might be interested to see how the different measurement approaches differ in accuracy and uncertainty. Let’s now use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MIy0bX6lE9"},{"type":"inlineCode","value":"seaborn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lXbgcPeagl"},{"type":"text","value":" to generate snow depth histograms for each instrument.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bqkqX678CJ"}],"key":"cwrh5Q5Ynh"}],"key":"AQeLOwRs5i"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import seaborn as sns\n\n# Get the unique measurement values\nunique_measurements = gdf['measurement_tool'].unique()\n\n# Make 1x3 figure for each tool\nfig, axs = plt.subplots(1, 3, figsize=(18, 6), sharey=True)\n# Set consistent background\nsns.set_style(\"whitegrid\")\n\n# Loop through unique measurement tools to make a plot for each\nfor i, measurement in enumerate(unique_measurements):\n    subset = gdf[gdf['measurement_tool']==measurement]\n\n    # Make a KDE plot normalized by density, rather than raw counts\n    sns.histplot(subset['snow_depth'],\n                 ax=axs[i],\n                 kde=True,\n                 bins=30,\n                 edgecolor='black',\n                 linewidth=0.5,\n                 stat=\"density\",\n                 common_norm=False\n                )\n\n    # Draw a vertical line at the median snow depth\n    median_val = subset['snow_depth'].median()\n    axs[i].axvline(median_val, color='green', linestyle='--', linewidth=2,\n                   label=f'Median: {median_val} cm')\n\n    # Add text that notes the total number of measurements\n    axs[i].text(\n            0.05, 0.95,\n            f\"n = {len(subset)}\",\n            transform=axs[i].transAxes,\n            fontsize=12,\n            verticalalignment='top'\n    )\n\n    axs[i].set_title(f'{measurement}', fontsize=14)\n    axs[i].set_xlabel(\"Depth (cm)\", fontsize=14)\n\n    # Set y-label only for first figure\n    if i == 0:\n        axs[i].set_ylabel(\"Density\", fontsize=14)\n    else:\n        axs[i].set_ylabel(\" \")\n\n    axs[i].legend(loc='upper right')\n\nplt.tight_layout()\nplt.show()","key":"ZGSUmj79gL"},{"type":"output","id":"R5ZSn96d9VZtQlogqyYD4","data":[],"key":"iaxDXeJKbT"}],"key":"uKTM1OhhYs"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Thanks to this plot, we can make a comparison between the different instruments. The magnaprobe depths are the lowest by a slight margin, and also appear to have the lowest spread in depths. The Mesa2 tablet depths are the highest by a few centimeters, and the pit rulers have the highest spread.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AQxYFPXdil"}],"key":"zdOp6Gnig2"}],"key":"LYhEjvsPD6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"SnowEx Database Example","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CRpPNjybIg"}],"identifier":"snowex-database-example","label":"SnowEx Database Example","html_id":"snowex-database-example","implicit":true,"key":"OmyEl6q2jG"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We will now attempt to achieve the same result, but with the SnowEx Database. Before we dive in, we will see what measurements are available through the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kW30YiQb5G"},{"type":"inlineCode","value":"snowexsql","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"KDl2ItaXMt"},{"type":"text","value":" package.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Xve4XvsYnC"}],"key":"jtTWuIMgZI"}],"key":"BOb3zucZCw"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"from snowexsql.api import PointMeasurements, LayerMeasurements\n\n# Instantiate the class to use the properties!\nmeasurements = PointMeasurements()\n\n# Get the unique data names/types in the table\nresults = measurements.all_types\nprint('Available types = {}'.format(', '.join([str(r) for r in results])))\n\n# Get the unique instrument in the table\nresults = measurements.all_instruments\nprint('\\nAvailable Instruments = {}'.format(', '.join([str(r) for r in results])))\n\n# Get the unique dates in the table\nresults = measurements.all_dates\nprint('\\nAvailable Dates = {}'.format(', '.join(sorted([str(r) for r in results]))))\n\n# Get the unique site names in the table\nresults = measurements.all_site_names\nprint('\\nAvailable sites = {}'.format(', '.join([str(r) for r in results])))","key":"VsgBBKOi10"},{"type":"output","id":"zohZnimxlKjeuGXEXApRy","data":[],"key":"FBnBw34l3E"}],"key":"ZOylctcxQx"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"So, we have quite of data available! The date range spans from September 2019 to March 2023, and we have snow depth, SWE, and density measurements accessible for multiple sites and instrument types.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yKCGgxa3YY"}],"key":"LusQ9fXsxy"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Since this is a generally faster method to access data, we will take an extra step and calculate SWE from the available snow depth and density data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sjFNnqzjMR"}],"key":"mLGnS7Ky7z"}],"key":"fsXAsJ2yZh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from datetime import datetime \n\n# Find some snow depth measurements at the Grand Mesa in early 2020.\nmagnaprobe = measurements.from_filter(\n    type=\"depth\",\n    site_name=\"Grand Mesa\",\n    instrument=\"magnaprobe\",\n    date_less_equal=datetime(2020, 3, 1),\n    date_greater_equal=datetime(2020, 1, 1),\n    limit=38000\n)","key":"dKH2sFV8jM"},{"type":"output","id":"7b3y_i_HZz0Q_fj7ePw0F","data":[],"key":"tBDdbJC3BG"}],"key":"wBZKpBbBdy"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"magnaprobe.head()","key":"omIGXCWCfM"},{"type":"output","id":"zVTUjQGR8ucjFVpnzdk5p","data":[],"key":"NLfamXcUkB"}],"key":"G0yyrztgti"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"A breakdown of the query:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"d6bNpghpUk"}],"key":"Jk6B8ljjwg"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"type","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sQuhuhLGSb"},{"type":"text","value":": The type of measurement we want (depth, swe, density, etc.)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Z2nKF0URMG"}],"key":"zSPoWrBHlv"}],"key":"QpJvR39Fjq"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"instrument","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BdabDeRd8v"},{"type":"text","value":": The instrument used to obtain the measurement. Here, we obtained ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DGKzGRHZ80"},{"type":"inlineCode","value":"magnaprobe","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XN7kHoF04w"},{"type":"text","value":" measurements only, but below we will also specify the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"k5uPGeGwuC"},{"type":"inlineCode","value":"mesa2","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rJItqnGqNB"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pOADYruZpx"},{"type":"inlineCode","value":"pit ruler","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aV6g6MpYg7"},{"type":"text","value":" measurements.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IWAnDtXFKw"}],"key":"pDl5PU3Fy5"}],"key":"TqQHbGsXNs"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"date_less_equal","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"eF43rOpi2Q"},{"type":"text","value":": The latest date for any observations. Here, our end date is March 1, 2020.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ShB1cs7nzw"}],"key":"Qd0YxHMU08"}],"key":"PJw4TU7ymJ"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"date_greater_equal","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"v59hij83kG"},{"type":"text","value":": The start date for our observations. Here, it is January 1, 2020.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LF4IVtBRkp"}],"key":"vokoNSHGoz"}],"key":"dkeH9jnhWB"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"limit","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"H3I2u4dDAp"},{"type":"text","value":": The maximum number of observations for our query. Larger numbers will result in longer loading times, though ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"N6i5aAu6JR"},{"type":"inlineCode","value":"38000","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"CJJ8gZDCCG"},{"type":"text","value":" works fairly quickly.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"BlL69vPBsa"}],"key":"l2bmuhdKsb"}],"key":"y6T6cJefyM"}],"key":"JgJBT7lN2P"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"The below plotting cell is identical to the one used in the ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"PrhV1BetKa"},{"type":"inlineCode","value":"earthaccess","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Kt3lhYnezS"},{"type":"text","value":" example. Let’s see if they agree!","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"pQf0ROWRNf"}],"key":"jF4rOH49zg"}],"key":"iOGHbYXddX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(figsize=(10, 10))\n\n# Define min/max values for colormap\nvmin = magnaprobe['value'].quantile(0.15)\nvmax = magnaprobe['value'].quantile(0.85)\n\n# Convert to EPSG:3857 to match with the contextily basemap\nif magnaprobe.crs != 'EPSG:3857':\n    gdf_web = magnaprobe.to_crs(epsg=3857)\n    ax.set_xlim(gdf_web.total_bounds[[0, 2]])\n    ax.set_ylim(gdf_web.total_bounds[[1, 3]])\nelse:\n    gdf_web = magnaprobe\n    ax.set_xlim(gdf.total_bounds[[0, 2]])\n    ax.set_ylim(gdf.total_bounds[[1, 3]])\n\n# Plot snow depths by location\ngdf_web.plot(\n    column='value',\n    ax=ax,\n    markersize=10,\n    cmap='cmc.navia',\n    legend=True,\n    legend_kwds={'shrink': 0.5, 'label': 'Snow depth [cm]'},\n    vmin=vmin,\n    vmax=vmax\n)\n\n# Add topographic map for spatial reference\nctx.add_basemap(\n    ax, \n    source=ctx.providers.OpenTopoMap,\n    zoom='auto'\n)\n\nax.set_xlabel(\"Easting [m]\", fontsize=14)\nax.set_ylabel(\"Northing [m]\", fontsize=14)\nplt.tight_layout()\nplt.show()","key":"R7F5mvmhdS"},{"type":"output","id":"sd6T4a11t1_zrfgnMXZFZ","data":[],"key":"j3xFKoEuXk"}],"key":"K5MZFymQVg"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"It’s quite close! We’re missing out on a few locations, but the number of missing points is negligible.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kIOut9AFrg"}],"key":"Zjg62o8uM8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now, we are going to calculate SWE. This means we need to grab snow density over the same domain. Note that in the below cell that no ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nHOPqbYBq1"},{"type":"inlineCode","value":"instrument","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HXVviHlYW2"},{"type":"text","value":" is defined. This is because a bulk density is provided over a handful of snow pits, with no specific instrument defined in the SnowEx Database.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sle32Bx16I"}],"key":"u6c8d6l4Bv"}],"key":"es1qairGpo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"density = measurements.from_filter(\n    type=\"density\",\n    site_name=\"Grand Mesa\",\n    date_less_equal=datetime(2020, 3, 1),\n    date_greater_equal=datetime(2020, 1, 1),\n    limit=38000\n)","key":"hEKYvJ214N"},{"type":"output","id":"UFBCSuuv3Ug8jupFOzmN9","data":[],"key":"hmSBXcWLah"}],"key":"opOaRG6lbQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"density.head()","key":"NiY1hEE541"},{"type":"output","id":"F0O9Jsk0deu20QXmZjKcD","data":[],"key":"Cn0mhPkmdB"}],"key":"ZPOpHlqL8d"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We have a much smaller number of snow density measurements than we do snow depths. To keep things simple, we are going to find the median density value across the domain, then use that value to calculate SWE for every snow depth measurement.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rRsXqqM4x9"}],"key":"CNAuLZ1jVp"}],"key":"T4KzQa3iL7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Calculate median density of available data\ndensity_median = density['value'][density['value']>=0].median()\n\n# Make a rough SWE calculation with median density and available snow depths\nmagnaprobe['swe'] = magnaprobe['value'] * (density_median/1000)","key":"WnW7n3R7pD"},{"type":"output","id":"bDQuqeYqIf7-VBGattumu","data":[],"key":"kxwR4OaAgp"}],"key":"gVzvLlaocb"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We are going to again repeat the process with the Mesa2 tablets and the pit rulers. As with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a7K1cFJx8a"},{"type":"inlineCode","value":"earthaccess","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BzYi2aeI9v"},{"type":"text","value":", we will use separate queries to grab these snow depths, then convert them to SWE with the median snow density.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UcZT2ZmhOZ"}],"key":"MNqTOxgccS"}],"key":"poRHoRsQU1"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Make a query for the Mesa2 tablets\nmesa2 = measurements.from_filter(\n    type=\"depth\",\n    site_name=\"Grand Mesa\",\n    instrument=\"mesa\",\n    date_less_equal=datetime(2020, 3, 1),\n    date_greater_equal=datetime(2020, 1, 1),\n    limit=38000\n)\n\nprint(f\"Found {len(mesa2)} Mesa2 tablet measurements.\")\n\n# Do the same for pit ruler measurements\npit_ruler = measurements.from_filter(\n    type=\"depth\",\n    site_name=\"Grand Mesa\",\n    instrument=\"pit ruler\",\n    date_less_equal=datetime(2020, 3, 1),\n    date_greater_equal=datetime(2020, 1, 1),\n    limit=38000\n)\n\nprint(f\"Found {len(pit_ruler)} pit ruler measurements.\")","key":"zlEj7nsjSc"},{"type":"output","id":"1w8M_ZYzAxG0j0DASfcBl","data":[],"key":"G4LZgYXSxd"}],"key":"ojd5IUWa0B"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Calculate SWE for Mesa2 and pit ruler measurements\nmesa2['swe'] = mesa2['value'] * (density_median*10e-6*1000)\npit_ruler['swe'] = pit_ruler['value'] * (density_median*10e-6*1000)","key":"bX5hFFTad8"},{"type":"output","id":"dZV_CVSvn9YQWOjBP02-t","data":[],"key":"jIxVExEG5c"}],"key":"huiUWqSDBt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"gdf = pd.concat([magnaprobe, mesa2, pit_ruler])","key":"psO4e0mHWW"},{"type":"output","id":"qVDmz_bPr3f8XAuPRNzqv","data":[],"key":"YelTzmNZLm"}],"key":"ndIwZHohp4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, we will recreate the histogram figure from the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XuOfqmzDEJ"},{"type":"inlineCode","value":"earthaccess","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VTygewhrrc"},{"type":"text","value":" example, this time with SWE.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WUZHmKkGI2"}],"key":"UJLFfhEbzL"}],"key":"casqhfxx7A"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import seaborn as sns\n\n# Get the unique measurement values\nunique_measurements = gdf['instrument'].unique()\n\n# Make 1x3 figure for each tool\nfig, axs = plt.subplots(1, 3, figsize=(18, 6), sharey=True)\n# Set consistent background\nsns.set_style(\"whitegrid\")\n\n# Loop through unique measurement tools to make a plot for each\nfor i, measurement in enumerate(unique_measurements):\n    subset = gdf[gdf['instrument']==measurement]\n\n    # Make a KDE plot normalized by density, rather than raw counts\n    sns.histplot(subset['swe'],\n                 ax=axs[i],\n                 kde=True,\n                 bins=30,\n                 edgecolor='black',\n                 linewidth=0.5,\n                 stat=\"density\",\n                 common_norm=False\n                )\n\n    # Draw a vertical line at the median snow depth\n    median_val = subset['swe'].median()\n    axs[i].axvline(median_val, color='green', linestyle='--', linewidth=2,\n                   label=f'Median: {median_val:.3g} mm')\n\n    # Add text that notes the total number of measurements\n    axs[i].text(\n            0.05, 0.95,\n            f\"n = {len(subset)}\",\n            transform=axs[i].transAxes,\n            fontsize=12,\n            verticalalignment='top'\n    )\n\n    axs[i].set_title(f'{measurement}', fontsize=14)\n    axs[i].set_xlabel(\"SWE (mm)\", fontsize=14)\n\n    # Set y-label only for first figure\n    if i == 0:\n        axs[i].set_ylabel(\"Density\", fontsize=14)\n    else:\n        axs[i].set_ylabel(\" \")\n\n    axs[i].legend(loc='upper right')\n\nplt.tight_layout()\nplt.show()","key":"gfEBtH3oLW"},{"type":"output","id":"0osPBaudIfJ09Ox21SZFi","data":[],"key":"lTbwnZgsVU"}],"key":"VD7LwxT350"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Looks great! We have a distribution of SWE values for all three instruments, and they have reasonable values distributed similarly to the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WjmLHSHMLc"},{"type":"inlineCode","value":"earthaccess","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yUvxT6gx8M"},{"type":"text","value":" depths.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MRPc6lRRJY"}],"key":"mhG7Siqk5P"}],"key":"KzAIMTR5rv"}],"key":"Cu2Zmzkpjo"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"SNOTEL Data Access","url":"/notebooks/snotel-data-access","group":"Observations"},"next":{"title":"Neural Networks with PyTorch","url":"/notebooks/pytorch-tutorial","group":"Analysis and Machine Learning"}}},"domain":"http://localhost:3000"}