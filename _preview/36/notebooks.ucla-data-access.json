{"version":2,"kind":"Notebook","sha256":"6d319c378156aaf0b7b0eafb1cddf951443bb235d19296dda94ae934abf9d63c","slug":"notebooks.ucla-data-access","location":"/notebooks/UCLA_data_access.ipynb","dependencies":[],"frontmatter":{"title":"Reanalysis Data Access","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"snow-cookbook-test","language":"python"},"authors":[{"nameParsed":{"literal":"The SnowPit Community","given":"The SnowPit","family":"Community"},"name":"The SnowPit Community","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/SnowEx/snow-cookbook","copyright":"2025","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/SnowEx/snow-cookbook/blob/HEAD/notebooks/UCLA_data_access.ipynb","edit_url":"https://github.com/SnowEx/snow-cookbook/edit/HEAD/notebooks/UCLA_data_access.ipynb","exports":[{"format":"ipynb","filename":"UCLA_data_access.ipynb","url":"/snow-cookbook/_preview/36/build/UCLA_data_access-6acc97de8a5c1624fbe54a07cdfccbe2.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This workbook is to access the Western United States snow reanalysis data set, as developed by UCLA. Normally, the data is provided as PNG or netCDF files, and it is not cloud-optimized. So, we will need to download the data into a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OjodBOXBPq"},{"type":"inlineCode","value":"tmp/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fCASoZfGv5"},{"type":"text","value":" folder, as a direct access will be computationally inefficient.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ju8yviWVTF"}],"key":"yvg7EkIe1g"}],"key":"P2MhfQJtJw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nimport earthaccess\nimport boto3\nimport cartopy.crs as ccrs\nimport cartopy.feature as cfeature\nimport matplotlib.pyplot as plt\nimport warnings\nfrom IPython.display import display, Markdown","key":"uGWdQ0uuCB"},{"type":"output","id":"S9jRT0zGm2NldZ1G7qtcy","data":[],"key":"Ok87mT9J3m"}],"key":"PSBgiDX9AO"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As implied by the dataset’s name, the UCLA reanalysis is only for the Western United States. For this example, we will look over the Tuolumne River Basin in California.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Qz1dtJK88V"}],"key":"cKXB3oeWpI"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As with the MERRA-2 example workbook, we will be using the dataset DOI to quickly access the data, and looking at the 2020-2021 water year.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lTN0uaonOj"}],"key":"UXWADYeDz1"}],"key":"MAupW9zOes"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"\"\"\" # Define bounding box over the Tuolumne\nbbox = (-119.85, 37.71, -119.1, 38.25)\n\n# Authenticate using Earthdata Login prerequisite files\nauth = earthaccess.login()\n\n# Search for the granule by DOI\nresults = earthaccess.search_data(\n    doi='10.5067/PP7T2GBI52I2',\n    temporal=(\"2020-10-01\", \"2021-09-30\"),\n    bounding_box = bbox\n) \"\"\"","key":"z9EtAGIPCY"},{"type":"output","id":"cWE7ST6dIHoKRr8WBUDmT","data":[],"key":"psiwU3tTas"}],"key":"s1nCa36yXt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\"\"\" # Download the files to a tmp folder, and save paths as a list\nfiles = earthaccess.download(results, \"tmp/\")\nfiles \"\"\"","key":"DATZ7dZAAB"},{"type":"output","id":"n2Qe5FmJZPtXQlPew1YwD","data":[],"key":"VmBjM7zVwR"}],"key":"bAgPb2bVyQ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The four files we downloaded provide reanalysis data for snow water equivalent and snow cover (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"joUuyxtYSY"},{"type":"inlineCode","value":"SWE_SCA_POST","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OOvYZ6FBvk"},{"type":"text","value":"), as well as snow depth (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lcxrpd3KLx"},{"type":"inlineCode","value":"SD_POST","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rTspG2BHHD"},{"type":"text","value":"). We have two files for each to correspond to different latitudes (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fRiCgkCdho"},{"type":"inlineCode","value":"N37","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"olbCNvQqrS"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RDgQujGKlN"},{"type":"inlineCode","value":"N38","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vmx1ogq4mD"},{"type":"text","value":" in the file names).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ktTeWRhluI"}],"key":"pBvAb2uDpy"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We could load these files individually, but Xarray has functionality to load all of them at once with ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hy1jTNk4ib"},{"type":"inlineCode","value":"xarray.open_mfdataset()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YbvnRGUxbI"},{"type":"text","value":"!","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"o6EiBf6dSm"}],"key":"v69mUzFW86"}],"key":"SZBXk1ajkL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# ds = xr.open_mfdataset(files)","key":"W7X0pPBCXQ"},{"type":"output","id":"0gyHl6wN2xqHmX0gnqezu","data":[],"key":"Pr7jGcd945"}],"key":"YebPugIsSt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# ds","key":"wt42uzc40I"},{"type":"output","id":"_MpWwZulpLJ6RMG1J5ZQW","data":[],"key":"KKy4pbKutO"}],"key":"jMHr5Pgsa4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Our DataArray has four dimensions: ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hTcjwTQDTp"},{"type":"inlineCode","value":"Day","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kBwH7lR2Ij"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aBb49SGWUy"},{"type":"inlineCode","value":"Stats","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DY2sm84N53"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a0dr6q1cIN"},{"type":"inlineCode","value":"Longitude","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k36xu8m0tK"},{"type":"text","value":", and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"heXVHSijjZ"},{"type":"inlineCode","value":"Latitude","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nPZ9zn2HIX"},{"type":"text","value":". ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bdGqvmpyui"},{"type":"inlineCode","value":"Days","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hwDV5jxZrF"},{"type":"text","value":" refers to the number of days after the start of the water year (October 1st), which isn’t very useful on its own. So, let’s change it into a datetime format.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mKE0ksdkR5"}],"key":"Mqmug5GY4x"}],"key":"eBHYyZ5Ijz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# import re\n# import pandas as pd\n\n# # Find year in file name\n# url = files[0]\n# date_pattern = r'\\d{4}'\n\n# # Convert year to start of water year (pd.datetime format)\n# WY_start_date = pd.to_datetime(f'{re.search(date_pattern, url).group()}-10-01')","key":"O96jK6Xq2d"},{"type":"output","id":"EqTzPx3iGUG-GHxfDLLUy","data":[],"key":"rSQ7NDqeH6"}],"key":"aF5fZ4QOx3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Define new coordinates that use dates rather than day numbers\n# ds.coords['time'] = (\"Day\", pd.date_range(WY_start_date, periods=ds.sizes['Day']))\n# ds = ds.swap_dims({'Day':'time'})","key":"Vcn9fH13jF"},{"type":"output","id":"Uh-0NL4iZ4JRScmX10cC4","data":[],"key":"zRJRvII6OH"}],"key":"Pt245A1n6y"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xXdaE8ZCXs"},{"type":"inlineCode","value":"Stats","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T5cBIyF4XE"},{"type":"text","value":" coordinate refers to the statistics that are available for each of the variables, but its inputs are numeric, rather than strings. The ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kPdgjCuZvb"},{"type":"inlineCode","value":"stats_dictionary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CGaladtRP6"},{"type":"text","value":" below outlines the statistics associated with each number, with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K93IAmiRaK"},{"type":"inlineCode","value":"25pct","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"v0WBfUfO6u"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KLORXTHJYi"},{"type":"inlineCode","value":"75pct","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"t1QeOZygYl"},{"type":"text","value":" referring to the 25th-percentile and the 75th-percentile, respectively.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OYvRa1q64o"}],"key":"bgpHZRzu3r"}],"key":"E9lCMtMPSD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Make dictionary of statistics\n# stats_dictionary = {'mean':0, \n#                     'std':1, \n#                     'median':2, \n#                     '25pct':3, \n#                     '75pct':4}\n\n# # Choose statistic of interest\n# stat = stats_dictionary['mean']","key":"RkKzTA579G"},{"type":"output","id":"w8tTcSMuUF62KG0zJhyLe","data":[],"key":"qoUXJVZDKf"}],"key":"y03A16RP10"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For this example, we are grabbing the mean daily SWE (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qnzYlx9csK"},{"type":"inlineCode","value":"SWE_Post","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ch5NQk6XjK"},{"type":"text","value":"):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DnzU5jmEuW"}],"key":"l9NIR2ilJi"}],"key":"nIKg6BeKUO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# mean_daily_swe = ds['SWE_Post'].sel(Stats=stat)","key":"eqcvOcdFdj"},{"type":"output","id":"nnsycAt8Kz6_KSIgRs5uj","data":[],"key":"KAuyGqWAk5"}],"key":"VAuJqEDgdM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# mean_daily_swe","key":"ViW9oMZsgw"},{"type":"output","id":"2NF5geX7xXbpe_hPwoDgk","data":[],"key":"glG7sipKWX"}],"key":"lp6kFrvIGj"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Looking at the output, we can see that the data now has “Array” and “Chunk” information. This is because the data was lazy-loaded through the dask, given that there is a lot of data stored in each file.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V7yb7xo9yG"}],"key":"a61ur4LoZ8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Before we plot the data, we will need to reduce it to our time frequency of interest (monthly, in this case). We will then properly load the data into memory.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hf8Vlaryjz"}],"key":"TTaLndiR1A"}],"key":"xWA3JNqyzP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Resample the SWE data to a monthly mean\n# mean_monthly_swe = mean_daily_swe.resample(time=\"1ME\").mean()","key":"zbJZ9kDsfs"},{"type":"output","id":"uJt1quWYto_5lTButBBkE","data":[],"key":"lHn77FcTGh"}],"key":"oHoiRvgnhB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Load the monthly mean data into memory\n# mean_monthly_swe = mean_monthly_swe.compute()","key":"Sv1aGSyTsA"},{"type":"output","id":"aPiD-O_B4jVNRRi8KxSOq","data":[],"key":"fgqKUtZWdF"}],"key":"KXpAZh78kI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Caution","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KMC6D1cQwp"}],"key":"LX6n3bAe0z"},{"type":"text","value":": The above plotting cell can be a bit time-consuming if you are working with a lot of files at once.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N7Vydq0Lu6"}],"key":"JgiUVggMyg"}],"key":"afPWON4HCH"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, we will make a figure showing the monthly SWE across an entire water year.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jpeNhNHf7w"}],"key":"EL90TDu6h2"}],"key":"R6sWabXC46"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Define months as strings, for subplot titles\n# months = ['October', 'November', 'December', 'January',\n#           'February', 'March', 'April', 'May',\n#           'June', 'July', 'August', 'September']\n\n# # Plot the SWE data as monthly means\n# fig = mean_monthly_swe.plot.imshow(\n#     col='time',\n#     col_wrap=4,\n#     cmap=\"Blues\",\n#     vmin=0,\n#     vmax=1,\n# )\n\n# # Set titles to month\n# for ax, title in zip(fig.axs.flatten(), months):\n#     ax.set_title(title, fontsize=12)\n\n# # Change colorbar label and label sizes``\n# fig.cbar.ax.tick_params(labelsize=16)\n# fig.cbar.set_label(label='SWE [m]', size=16, weight='bold')","key":"CWl637zmPp"},{"type":"output","id":"Kq8v4G9PsasmchDZ4fF7c","data":[],"key":"GrTrAcCfXY"}],"key":"whuGgnkpGT"}],"key":"tdsWCJYDMN"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"SNOTEL Data Access","url":"/notebooks/snotel-data-access","group":"Observations"},"next":{"title":"MERRA-2","url":"/notebooks/merra2-data-access","group":"Analysis and Machine Learning"}}},"domain":"http://localhost:3000"}